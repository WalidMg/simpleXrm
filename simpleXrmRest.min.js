var simpleXrmRest={fakeIt:function(){window.JSON||(console.log("It is not 1991 anymore. Please retire your Apple II or CalecoVision and use a browser that supports JSON."),window.JSON={parse:function(sJSON){return eval("("+sJSON+")")},stringify:function(n){var t,i,r;if(n instanceof Object){if(t="",n.constructor===Array){for(i=0;i<n.length;t+=this.stringify(n[i])+",",i++);return"["+t.substr(0,t.length-1)+"]"}if(n.toString!==Object.prototype.toString)return'"'+n.toString().replace(/"/g,"\\$&")+'"';for(r in n)t+='"'+r.replace(/"/g,"\\$&")+'":'+this.stringify(n[r])+",";return"{"+t.substr(0,t.length-1)+"}"}return typeof n=="string"?'"'+n.replace(/"/g,"\\$&")+'"':String(n)}});simpleXrm.timedFormWarning("It is not 1991 anymore. Please retire your Apple II or CalecoVision and use a browser that supports JSON.",3e3,"ShameOnYou")},parseDate:function(n,t){var i;return typeof t=="string"&&(i=/Date\(([-+]?\d+)\)/.exec(t),i)?new Date(parseInt(t.replace("/Date(","").replace(")/",""),10)):t},XHR:function(n){var t=Xrm.Page.context.getClientUrl();if(simpleXrm.valid(t)){if(t+="/XRMServices/2011/OrganizationData.svc/"+n.query.toString(),window.XMLHttpRequest)XHR=new XMLHttpRequest;else if(window.ActiveXObject)XHR=new ActiveXObject("Microsoft.XMLHTTP");else return simpleXrm.error("We encountered an unexpected issue. Please check your form data before proceeding. Info for Admin: User's browser may not support one of the requested scripts. Please attempt using FireFox or IE 8+"),null;XHR.open("GET",encodeURI(t),!1);XHR.setRequestHeader("Accept","application/json");XHR.setRequestHeader("Content-Type","application/json; charset=utf-8");XHR.onreadystatechange=n.callback;XHR.send()}},query:function(n){simpleXrmRest.XHR({query:simpleXrmRest.buildQuery({entitySet:n.entitySet,select:simpleXrmRest.select(n.select),filter:simpleXrmRest.filter(n.filter),orderBy:simpleXrmRest.orderBy(n.orderBy),expand:simpleXrmRest.expand(n.expand),skip:simpleXrmRest.skip(n.skip),top:simpleXrmRest.top(n.top)}),callback:n.callback})},mapResults:function(n){var i=n.map,t=n.results;for(x in i)!t[x]||(typeof t[x]=="object"?t[x].Value?simpleXrm.setAttVal(i[x],t[x].Value):!t[x].Id||!t[x].Name?simpleXrm.clearAttVal(i[x]):simpleXrm.setAttVal(i[x],simpleXrm.parseRESTLookup(t[x])):simpleXrm.setAttVal(i[x],t[x]))},buildQuery:function(n){var t="",o=n.entitySet,i=n.select,r=n.filter,u=n.orderBy,f=n.expand,e=n.skip,s=n.top;return simpleXrm.valid(o)&&(t+=o.toString()+"?"),simpleXrm.valid(i)&&(t+=i.toString()),simpleXrm.valid(r)&&(simpleXrm.valid(i)&&(t+="&"),t+=r.toString()),simpleXrm.valid(u)&&((simpleXrm.valid(i)||simpleXrm.valid(r))&&(t+="&"),t+=u.toString()),simpleXrm.valid(f)&&((simpleXrm.valid(i)||simpleXrm.valid(r)||simpleXrm.valid(u))&&(t+="&"),t+=f.toString()),simpleXrm.valid(e)&&((simpleXrm.valid(i)||simpleXrm.valid(r)||simpleXrm.valid(u)||simpleXrm.valid(f))&&(t+="&"),t+=e.toString()),simpleXrm.valid(s)&&((simpleXrm.valid(i)||simpleXrm.valid(r)||simpleXrm.valid(u)||simpleXrm.valid(f)||simpleXrm.valid(e))&&(t+="&"),t+=s.toString()),t},buildFilter:function(n){return""+(n.operator==="startswith"||n.operator==="substringof"||n.operator==="endswith"?n.operator+"("+n.attribute+","+n.value+")":n.attribute+" "+n.operator+" "+n.value)},groupFiltersOr:function(){return"("+arguments.join(" or ")+")"},groupFiltersAnd:function(){return"("+arguments.join(" and ")},filter:function(){for(var t=[],n=0;n<arguments.length;n++)typeof arguments[n]=="object"?t.push(simpleXrmRest.buildFilter(arguments[n])):typeof arguments[n]=="string"&&t.push(arguments[n]);return"$filter="+simpleXrm.link(t," and ")},select:function(){return"$select="+simpleXrm.link(arguments,",")},selectFromExpanded:function(n){for(var i=[],t=1;t<arguments.length;t++)i.push(n.toString()+"/"+arguments[t].toString());return simpleXrm.link(i,",")},expand:function(){return"$expand="+simpleXrm.link(arguments,",")},orderBy:function(){return"$orderby="+simpleXrm.link(arguments,",")},skip:function(n){return"$skip="+n.toString()},top:function(n){return"$top="+n.toString()},queryLookup:function(n){var t="guid'"+simpleXrm.cleanGuid(simpleXrm.getLookupID(n.lookup.toString()))+"'",i=n.entityType+"Set",r=simpleXrmRest.buildFilter({attribute:n.entityType+"Id",operator:"eq",value:t}),u=simpleXrmRest.filter(r),f=simpleXrmRest.select(simpleXrm.link(n.attributes,","));return simpleXrmRest.buildQuery({entitySet:i,filter:u,select:f})},parseOnReady:function(n){if(n.readyState===4&&n.status===200)return JSON.parse(n.responseText).d},normalizeResults:function(n){return simpleXrmRest.getRetrieveSingleResults(n)},getRetrieveSingleResults:function(n){var t=null,i=simpleXrmRest.parseOnReady(n),r,u,f;return simpleXrm.valid(i)&&(r=i.results,u=i.result,simpleXrm.valid(r)?(f=r[0],simpleXrm.valid(f)&&(t=f)):simpleXrm.valid(u)&&(t=u)),t},getRetrieveMultipleResults:function(n){var i=null,r=simpleXrmRest.parseOnReady(n),t;return simpleXrm.valid(r)&&(t=r.results,simpleXrm.valid(t)&&(i=t)),i},setPriceListPrice:function(n){var t={product:null||simpleXrm.getLookupID(n.productLookupField),pricelist:null||simpleXrm.getLookupID(n.priceListLookupField),unitPriceField:n.unitPriceField,listPriceField:n.listPriceField,unitField:n.unitField,callback:null||n.callback};simpleXrm.valid(t.product)&&simpleXrm.valid(t.pricelist)&&simpleXrmRest.XHR({query:simpleXrmRest.buildQuery({entitySet:"ProductSet",select:"$select=CurrentCost,ProductNumber,Price,StandardCost",filter:"$filter=ProductId eq guid'"+t.product+"'"}),callback:function(){var i=simpleXrmRest.normalizeResults(this);simpleXrm.valid(i)&&(t.currentCost=i.CurrentCost.Value,typeof t.currentCost=="string"&&(t.currentCost=parseFloat(t.currentCost)),t.productNumber=i.ProductNumber,t.listPrice=i.Price.Value,typeof t.listPrice=="string"&&(t.listPrice=parseFloat(t.listPrice)),t.standardCost=i.StandardCost.Value,typeof t.standardCost=="string"&&(t.standardCost=parseFloat(t.standardCost)),simpleXrm.setAttVal(t.listPriceField,t.listPrice),simpleXrm.sendAttAlways(t.listPriceField),simpleXrmRest.XHR({query:simpleXrmRest.buildQuery({entitySet:"ProductPriceLevelSet",select:"$select=Amount,Percentage,PricingMethodCode,UoMId,RoundingOptionCode,RoundingPolicyCode,RoundingOptionAmount",filter:"$filter=(PriceLevelId/Id eq guid'"+t.pricelist+"' and ProductId/Id eq guid'"+t.product+"')"}),callback:function(){var u=simpleXrmRest.normalizeResults(this),i,f,r,e;if(u){t.amount=u.Amount.Value;typeof t.amount=="string"&&(t.amount=parseFloat(t.amount));t.percentage=u.Percentage;typeof t.percentage=="string"&&(t.percentage=parseFloat(t.percentage));t.pricingMethodCode=u.PricingMethodCode.Value;t.unit=simpleXrm.parseRESTLookup(u.UoMId);simpleXrm.setAttVal(t.unitField,t.unit);simpleXrm.sendAttAlways(t.unitField);t.roundingOptionCode=u.RoundingOptionCode.Value;t.roundingPolicyCode=u.RoundingPolicyCode.Value;t.roundingOptionAmount=u.RoundingOptionAmount;typeof t.roundingOptionAmount=="string"&&(t.roundingOptionAmount=parseFloat(t.roundingOptionAmount));i=null;f=!0;t.roundingPolicyCode==1&&(f=!1);switch(t.pricingMethodCode){case 1:i=t.amount;f=!1;break;case 2:i=t.percentage*t.listPrice/100;break;case 3:i=(t.percentage+100)*t.currentCost/100;break;case 4:i=100*t.currentCost/(100-t.percentage);break;case 5:i=(t.percentage+100)*t.standardCost/100;break;case 6:i=100*t.standardCost/(100-t.percentage);break;default:i=t.listPrice}if(f!=!0&&simpleXrm.valid(i))simpleXrm.setAttVal(n.unitPriceField,i);else if(f===!0&&simpleXrm.valid(i)){r=null;e=null;switch(t.roundingPolicyCode){case 2:t.roundingOptionCode==1?(r=10*Math.floor(i/10)+t.roundingOptionAmount,i>r&&(r+=10)):t.roundingOptionCode==2&&(r=Math.ceil(i/t.roundingOptionAmount)*t.roundingOptionAmount);break;case 3:t.roundingOptionCode==1?(r=10*Math.floor(i/10)+t.roundingOptionAmount,i<r&&(r-=10)):t.roundingOptionCode==2&&(r=Math.floor(i/t.roundingOptionAmount)*t.roundingOptionAmount);break;case 4:t.roundingOptionCode==1?(r=10*Math.floor(i/10)+t.roundingOptionAmount,i>r?e=r+10:i<r&&(r-=10,e=r+10),Math.abs(i-r)>Math.abs(i-e)&&(r=e)):t.roundingOptionCode==2&&(r=Math.round(i/t.roundingOptionAmount)*t.roundingOptionAmount)}simpleXrm.valid(r)&&(i=r)}simpleXrm.setAttVal(t.unitPriceField,i);simpleXrm.sendAttAlways(t.unitPriceField);try{t.callback()}catch(o){simpleXrm.timedFormError("The callback function could not be invoked.",3e3)}}else simpleXrm.timedFormError("The Price List Item could not be loaded.",3e3)}}))}})}};
/*
//# sourceMappingURL=simpleXrmRest.min.js.map
*/